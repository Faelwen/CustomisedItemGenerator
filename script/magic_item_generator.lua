aSpecialMaterials = {
	["Adamantine"] = {
		sStringName         = "adamantine",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = true,
		bAmmunition         = true,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Alchemical silver"] = {
		sStringName         = "silver",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Angelskin"] = {
		sStringName         = "angelskin",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = false,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Blood crystal"] = {
		sStringName         = "blood crystal",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Cold iron"] = {
		sStringName         = "cold iron",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Darkleaf cloth"] = {
		sStringName         = "darkleaf cloth",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = false,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Darkwood"] = {
		sStringName         = "darkwood",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = true,
		bMeleeWeapon        = true,
		bRangedWeapon       = true,
		bAmmunition         = true,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Dragonhide"] = {
		sStringName         = "dragonhide",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = true,
		bMeleeWeapon        = false,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Eel hide"] = {
		sStringName         = "eel hide",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = false,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Elysian bronze"] = {
		sStringName         = "elysian bronze",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = true,
		bMeleeWeapon        = true,
		bRangedWeapon       = true,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Fire-forged steel"] = {
		sStringName         = "fire forged steel",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = true,
		bMeleeWeapon        = true,
		bRangedWeapon       = true,
		bAmmunition         = true,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Frost-forged steel"] = {
		sStringName         = "frost forged steel",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = true,
		bMeleeWeapon        = true,
		bRangedWeapon       = true,
		bAmmunition         = true,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Greenwood"] = {
		sStringName         = "greenwood",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Griffon mane"] = {
		sStringName         = "griffon mane",
		bLightArmor         = true,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = false,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Living steel"] = {
		sStringName         = "living steel",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = true,
		bMeleeWeapon        = true,
		bRangedWeapon       = true,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Mithral"] = {
		sStringName         = "mithral",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = true,
		bShield             = true,
		bMeleeWeapon        = true,
		bRangedWeapon       = true,
		bAmmunition         = true,
		bAlwaysMasterwork   = true,
		bFagile             = false,
	},
	["Viridium"] = {
		sStringName         = "viridium",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Whipwood"] = {
		sStringName         = "whipwood",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Wyroot"] = {
		sStringName         = "wyroot",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = false,
		bFagile             = false,
	},
	["Bone"] = {
		sStringName         = "bone",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = false,
		bFagile             = true,
	},
	["Bronze"] = {
		sStringName         = "bronze",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = false,
		bShield             = true,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = true,
	},
	["Gold"] = {
		sStringName         = "gold",
		bLightArmor         = true,
		bMediumArmor        = true,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = false,
		bAlwaysMasterwork   = false,
		bFagile             = true,
	},
	["Obsidian"] = {
		sStringName         = "obsidian",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = true,
	},
	["Stone"] = {
		sStringName         = "stone",
		bLightArmor         = false,
		bMediumArmor        = false,
		bHeavyArmor         = false,
		bShield             = false,
		bMeleeWeapon        = true,
		bRangedWeapon       = false,
		bAmmunition         = true,
		bAlwaysMasterwork   = false,
		bFagile             = true,
	},
}

aMeleeWeaponAbilities = {
	["Advancing"] = {
		sStringName  = "advancing",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Allying"] = {
		sStringName  = "allying",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Anarchic"] = {
		sStringName  = "anarchic",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Anchoring"] = {
		sStringName  = "anchoring",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Axiomatic"] = {
		sStringName  = "axiomatic",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Bane"] = {
		sStringName  = "bane",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate conjuration" ,
	},
	["Benevolent"] = {
		sStringName  = "benevolent",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint enchantment" ,
	},
	["Brilliant energy"] = {
		sStringName  = "brilliant energy",
		iBonus       = 4,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 16,
		sAura = "strong transmutation" ,
	},
	["Called"] = {
		sStringName  = "called",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Conductive"] = {
		sStringName  = "conductive",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate necromancy" ,
	},
	["Corrosive"] = {
		sStringName  = "corrosive",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Corrosive burst"] = {
		sStringName  = "corrosive burst",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 12,
		sAura = "moderate evocation" ,
	},
	["Countering"] = {
		sStringName  = "countering",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Courageous"] = {
		sStringName  = "courageous",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 3,
		sAura = "faint enchantment" ,
	},
	["Cruel"] = {
		sStringName  = "cruel",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint necromancy" ,
	},
	["Cunning"] = {
		sStringName  = "cunning",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 6,
		sAura = "moderate divination" ,
	},
	["Dancing"] = {
		sStringName  = "dancing",
		iBonus       = 4,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 15,
		sAura = "strong transmutation" ,
	},
	["Deadly"] = {
		sStringName  = "deadly",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint necromancy" ,
	},
	["Defending"] = {
		sStringName  = "defending",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate abjuration" ,
	},
	["Defiant"] = {
		sStringName  = "defiant",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "strong abjuration" ,
	},
	["Dispelling"] = {
		sStringName  = "dispelling",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "strong abjuration" ,
	},
	["Dispelling burst"] = {
		sStringName  = "dispelling burst",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 12,
		sAura = "strong abjuration" ,
	},
	["Disruption"] = {
		sStringName  = "disruption",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = false,
		bPiercing    = false,
		bBludgeoning = true,
		iCL = 14,
		sAura = "strong conjuration" ,
	},
	["Dueling"] = {
		sStringName  = "dueling",
		iBonus       = 5,
		iCost        = 14000,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Flaming"] = {
		sStringName  = "flaming",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Flaming burst"] = {
		sStringName  = "flaming burst",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 12,
		sAura = "strong evocation" ,
	},
	["Frost"] = {
		sStringName  = "frost",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate evocation" ,
	},
	["Furious"] = {
		sStringName  = "furious",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate enchantment" ,
	},
	["Furyborn"] = {
		sStringName  = "furyborn",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate enchantment" ,
	},
	["Ghost touch"] = {
		sStringName  = "ghost touch",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Glamered"] = {
		sStringName  = "glamered",
		iBonus       = 1,
		iCost        = 4000,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate illusion" ,
	},
	["Glorious"] = {
		sStringName  = "glorious",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "moderate evocation" ,
	},
	["Grayflame"] = {
		sStringName  = "grayflame",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 6,
		sAura = "moderate transmutation" ,
	},
	["Grounding"] = {
		sStringName  = "grounding",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Guardian"] = {
		sStringName  = "guardian",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate abjuration" ,
	},
	["Heartseeker"] = {
		sStringName  = "heartseeker",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate necromancy" ,
	},
	["Holy"] = {
		sStringName  = "holy",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Huntsman"] = {
		sStringName  = "huntsman",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate divination" ,
	},
	["Icy burst"] = {
		sStringName  = "icy burst",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Igniting"] = {
		sStringName  = "igniting",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 12,
		sAura = "strong evocation" ,
	},
	["Impact"] = {
		sStringName  = "impact",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = false,
		iCL = 9,
		sAura = "moderate transmutation" ,
	},
	["Impervious"] = {
		sStringName  = "impervious",
		iBonus       = 1,
		iCost        = 3000,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Invigorating"] = {
		sStringName  = "invigorating",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint enchantment" ,
	},
	["Jurist"] = {
		sStringName  = "jurist",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 4,
		sAura = "faint transmutation" ,
	},
	["Keen"] = {
		sStringName  = "keen",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = false,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Ki focus"] = {
		sStringName  = "ki focus",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate transmutation" ,
	},
	["Ki intensifying"] = {
		sStringName  = "ki intensifying",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 12,
		sAura = "strong transmutation" ,
	},
	["Lifesurge"] = {
		sStringName  = "lifesurge",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate conjuration" ,
	},
	["Limning"] = {
		sStringName  = "limning",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint evocation" ,
	},
	["Menacing"] = {
		sStringName  = "menacing",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate illusion" ,
	},
	["Merciful"] = {
		sStringName  = "merciful",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint conjuration" ,
	},
	["Mighty cleaving"] = {
		sStringName  = "mighty cleaving",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate evocation" ,
	},
	["Mimetic"] = {
		sStringName  = "mimetic",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint abjuration" ,
	},
	["Negating"] = {
		sStringName  = "negating",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "moderate abjuration" ,
	},
	["Neutralizing"] = {
		sStringName  = "neutralizing",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Nullifying"] = {
		sStringName  = "nullifying",
		iBonus       = 3,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 12,
		sAura = "strong abjuration" ,
	},
	["Ominous"] = {
		sStringName  = "ominous",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint evocation" ,
	},
	["Phase locking"] = {
		sStringName  = "phase locking",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate abjuration" ,
	},
	["Planar"] = {
		sStringName  = "planar",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Quenching"] = {
		sStringName  = "quenching",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Repositioning"] = {
		sStringName  = "repositioning",
		iBonus       = 3,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate enchantment" ,
	},
	["Seaborne"] = {
		sStringName  = "seaborne",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Shock"] = {
		sStringName  = "shock",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 8,
		sAura = "moderate evocation" ,
	},
	["Shocking burst"] = {
		sStringName  = "shocking burst",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Speed"] = {
		sStringName  = "speed",
		iBonus       = 3,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Spell storing"] = {
		sStringName  = "spell storing",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 13,
		sAura = "strong divination" ,
	},
	["Spellstealing"] = {
		sStringName  = "spellstealing",
		iBonus       = 3,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 12,
		sAura = "strong evocation and varies" ,
	},
	["Stalking"] = {
		sStringName  = "stalking",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate divination" ,
	},
	["Thawing"] = {
		sStringName  = "thawing",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Throwing"] = {
		sStringName  = "throwing",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Thundering"] = {
		sStringName  = "thundering",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint necromancy" ,
	},
	["Transformative"] = {
		sStringName  = "transformative",
		iBonus       = 5,
		iCost        = 10000,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Unholy"] = {
		sStringName  = "unholy",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Valiant"] = {
		sStringName  = "valiant",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 5,
		sAura = "faint divination" ,
	},
	["Vicious"] = {
		sStringName  = "vicious",
		iBonus       = 1,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 9,
		sAura = "moderate necromancy" ,
	},
	["Vorpal"] = {
		sStringName  = "vorpal",
		iBonus       = 5,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = false,
		bBludgeoning = false,
		iCL = 18,
		sAura = "strong necromancy and transmutation" ,
	},
	["Wounding"] = {
		sStringName  = "wounding",
		iBonus       = 2,
		iCost        = 0,
		bSlashing    = true,
		bPiercing    = true,
		bBludgeoning = true,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
}

aRangedWeaponAbilities = {
	["Adaptive"] = {
		sStringName  = "adaptive",
		iBonus       = 1,
		iCost        = 1000,
		bFirearm     = false,
		bBow         = true,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 1,
		sAura = "faint transmutation" ,
	},
	["Impervious"] = {
		sStringName  = "impervious",
		iBonus       = 1,
		iCost        = 3000,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Glamered"] = {
		sStringName  = "glamered",
		iBonus       = 1,
		iCost        = 4000,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Allying"] = {
		sStringName  = "allying",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Bane"] = {
		sStringName  = "bane",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Called"] = {
		sStringName  = "called",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 8,
		sAura = "moderate conjuration" ,
	},
	["Conductive"] = {
		sStringName  = "conductive",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 16,
		sAura = "strong transmutation" ,
	},
	["Conserving"] = {
		sStringName  = "conserving",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = true,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Corrosive"] = {
		sStringName  = "corrosive",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 8,
		sAura = "moderate necromancy" ,
	},
	["Cruel"] = {
		sStringName  = "cruel",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate conjuration" ,
	},
	["Cunning"] = {
		sStringName  = "cunning",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 12,
		sAura = "moderate evocation" ,
	},
	["Distance"] = {
		sStringName  = "distance",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Flaming"] = {
		sStringName  = "flaming",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 5,
		sAura = "faint necromancy" ,
	},
	["Frost"] = {
		sStringName  = "frost",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 6,
		sAura = "moderate divination" ,
	},
	["Huntsman"] = {
		sStringName  = "huntsman",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 12,
		sAura = "moderate enchantment" ,
	},
	["Jurist"] = {
		sStringName  = "jurist",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate enchantment" ,
	},
	["Limning"] = {
		sStringName  = "limning",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 6,
		sAura = "moderate divination" ,
	},
	["Lucky"] = {
		sStringName  = "lucky",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = true,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Merciful"] = {
		sStringName  = "merciful",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 12,
		sAura = "strong evocation" ,
	},
	["Planar"] = {
		sStringName  = "planar",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Reliable"] = {
		sStringName  = "reliable",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = true,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 8,
		sAura = "moderate evocation" ,
	},
	["Returning"] = {
		sStringName  = "returning",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = true,
		iCL = 10,
		sAura = "moderate illusion" ,
	},
	["Seeking"] = {
		sStringName  = "seeking",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Shock"] = {
		sStringName  = "shock",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate divination" ,
	},
	["Thundering"] = {
		sStringName  = "thundering",
		iBonus       = 1,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Anarchic"] = {
		sStringName  = "anarchic",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 12,
		sAura = "strong evocation" ,
	},
	["Anchoring"] = {
		sStringName  = "anchoring",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = true,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = true,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Axiomatic"] = {
		sStringName  = "axiomatic",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 4,
		sAura = "faint transmutation" ,
	},
	["Corrosive burst"] = {
		sStringName  = "corrosive burst",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 5,
		sAura = "faint evocation" ,
	},
	["Designating, lesser"] = {
		sStringName  = "lesser designating",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 12,
		sAura = "strong enchantment" ,
	},
	["Endless ammunition"] = {
		sStringName  = "endless ammunition",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = true,
		bCrossbow    = true,
		bThrown      = false,
		iCL = 8,
		sAura = "moderate transmutation" ,
	},
	["Flaming burst"] = {
		sStringName  = "flaming burst",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 5,
		sAura = "faint conjuration" ,
	},
	["Holy"] = {
		sStringName  = "holy",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 11,
		sAura = "moderate abjuration" ,
	},
	["Icy burst"] = {
		sStringName  = "icy burst",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate abjuration" ,
	},
	["Igniting"] = {
		sStringName  = "igniting",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Phase locking"] = {
		sStringName  = "phase locking",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 12,
		sAura = "strong enchantment" ,
	},
	["Shocking burst"] = {
		sStringName  = "shocking burst",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 8,
		sAura = "moderate transmutation" ,
	},
	["Stalking"] = {
		sStringName  = "stalking",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Unholy"] = {
		sStringName  = "unholy",
		iBonus       = 2,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 11,
		sAura = "moderate abjuration" ,
	},
	["Lucky, greater"] = {
		sStringName  = "greater lucky",
		iBonus       = 3,
		iCost        = 0,
		bFirearm     = true,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 12,
		sAura = "strong divination" ,
	},
	["Reliable, greater"] = {
		sStringName  = "greater reliable",
		iBonus       = 3,
		iCost        = 0,
		bFirearm     = true,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 8,
		sAura = "moderate evocation" ,
	},
	["Speed"] = {
		sStringName  = "speed",
		iBonus       = 3,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Brilliant energy"] = {
		sStringName  = "brilliant energy",
		iBonus       = 4,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Designating, greater"] = {
		sStringName  = "greater designating",
		iBonus       = 4,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 10,
		sAura = "moderate divination" ,
	},
	["Nimble shot"] = {
		sStringName  = "nimble shot",
		iBonus       = 4,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 5,
		sAura = "faint necromancy" ,
	},
	["Second chance"] = {
		sStringName  = "second chance",
		iBonus       = 4,
		iCost        = 0,
		bFirearm     = false,
		bBow         = false,
		bCrossbow    = false,
		bThrown      = false,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
}

aAmmunitionAbilities = {
	["Anarchic"] = {
		sStringName  = "anarchic",
		iBonus       = 2,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Axiomatic"] = {
		sStringName  = "axiomatic",
		iBonus       = 2,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Bane"] = {
		sStringName  = "bane",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate conjuration" ,
	},
	["Brilliant energy"] = {
		sStringName  = "brilliant energy",
		iBonus       = 4,
		iCost        = 0,
		iCL = 16,
		sAura = "strong transmutation " ,
	},
	["Conductive"] = {
		sStringName  = "conductive",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate necromancy" ,
	},
	["Corrosive"] = {
		sStringName  = "corrosive",
		iBonus       = 1,
		iCost        = 0,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Corrosive burst"] = {
		sStringName  = "corrosive burst",
		iBonus       = 2,
		iCost        = 0,
		iCL = 12,
		sAura = "moderate evocation" ,
	},
	["Cruel"] = {
		sStringName  = "cruel",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint necromancy" ,
	},
	["Cunning"] = {
		sStringName  = "cunning",
		iBonus       = 1,
		iCost        = 0,
		iCL = 6,
		sAura = "moderate divination" ,
	},
	["Designating, greater"] = {
		sStringName  = "greater designating",
		iBonus       = 4,
		iCost        = 0,
		iCL = 12,
		sAura = "moderate enchantment" ,
	},
	["Designating, lesser"] = {
		sStringName  = "lesser designating",
		iBonus       = 2,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate enchantment" ,
	},
	["Dry load"] = {
		sStringName  = "dry load",
		iBonus       = 1,
		iCost        = 1500,
		iCL = 3,
		sAura = "faint abjuration" ,
	},
	["Flaming"] = {
		sStringName  = "flaming",
		iBonus       = 1,
		iCost        = 0,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Flaming burst"] = {
		sStringName  = "flaming burst",
		iBonus       = 2,
		iCost        = 0,
		iCL = 12,
		sAura = "strong evocation" ,
	},
	["Frost"] = {
		sStringName  = "frost",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate evocation" ,
	},
	["Ghost touch"] = {
		sStringName  = "ghost touch",
		iBonus       = 1,
		iCost        = 0,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Holy"] = {
		sStringName  = "holy",
		iBonus       = 2,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Icy burst"] = {
		sStringName  = "icy burst",
		iBonus       = 2,
		iCost        = 0,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Igniting"] = {
		sStringName  = "igniting",
		iBonus       = 2,
		iCost        = 0,
		iCL = 12,
		sAura = "strong evocation" ,
	},
	["Limning"] = {
		sStringName  = "limning",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint evocation" ,
	},
	["Merciful"] = {
		sStringName  = "merciful",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint conjuration" ,
	},
	["Phase locking"] = {
		sStringName  = "phase locking",
		iBonus       = 2,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate abjuration" ,
	},
	["Planar"] = {
		sStringName  = "planar",
		iBonus       = 1,
		iCost        = 0,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Seeking"] = {
		sStringName  = "seeking",
		iBonus       = 1,
		iCost        = 0,
		iCL = 12,
		sAura = "strong divination" ,
	},
	["Shock"] = {
		sStringName  = "shock",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate evocation" ,
	},
	["Shocking burst"] = {
		sStringName  = "shocking burst",
		iBonus       = 2,
		iCost        = 0,
		iCL = 10,
		sAura = "moderate evocation" ,
	},
	["Thundering"] = {
		sStringName  = "thundering",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint necromancy" ,
	},
	["Unholy"] = {
		sStringName  = "unholy",
		iBonus       = 2,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
}

aArmorAbilities = {
	["Adhesive"] = {
		sStringName  = "adhesive",
		iBonus       = 3,
		iCost        = 7000,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Balanced"] = {
		sStringName  = "balanced",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Benevolent"] = {
		sStringName  = "benevolent",
		iBonus       = 1,
		iCost        = 2000,
		iCL = 5,
		sAura = "faint enchantment" ,
	},
	["Bitter"] = {
		sStringName  = "bitter",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Bolstering"] = {
		sStringName  = "bolstering",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint enchantment" ,
	},
	["Brawling"] = {
		sStringName  = "brawling",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Champion"] = {
		sStringName  = "champion",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint abjuration" ,
	},
	["Creeping"] = {
		sStringName  = "creeping",
		iBonus       = 2,
		iCost        = 5000,
		iCL = 7,
		sAura = "moderate illusion and transmutation" ,
	},
	["Dastard"] = {
		sStringName  = "dastard",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint abjuration" ,
	},
	["Deathless"] = {
		sStringName  = "deathless",
		iBonus       = 1,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate abjuration" ,
	},
	["Defiant"] = {
		sStringName  = "defiant",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate conjuration" ,
	},
	["Delving"] = {
		sStringName  = "delving",
		iBonus       = 3,
		iCost        = 10000,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Determination"] = {
		sStringName  = "determination",
		iBonus       = 5,
		iCost        = 30000,
		iCL = 10,
		sAura = "moderate conjuration" ,
	},
	["Energy resistance"] = {
		sStringName  = "energy resistance",
		iBonus       = 4,
		iCost        = 18000,
		iCL = 3,
		sAura = "faint abjuration" ,
	},
	["Energy resistance, greater"] = {
		sStringName  = "greater energy resistance",
		iBonus       = 5,
		iCost        = 66000,
		iCL = 11,
		sAura = "moderate abjuration" ,
	},
	["Energy resistance, improved"] = {
		sStringName  = "improved energy resistance",
		iBonus       = 5,
		iCost        = 42000,
		iCL = 7,
		sAura = "moderate abjuration" ,
	},
	["Etherealness"] = {
		sStringName  = "etherealness",
		iBonus       = 5,
		iCost        = 49000,
		iCL = 13,
		sAura = "strong transmutation" ,
	},
	["Expeditious"] = {
		sStringName  = "expeditious",
		iBonus       = 2,
		iCost        = 4000,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Fortification (heavy)"] = {
		sStringName  = "heavy fortification",
		iBonus       = 5,
		iCost        = 0,
		iCL = 13,
		sAura = "strong abjuration" ,
	},
	["Fortification (light)"] = {
		sStringName  = "light fortification",
		iBonus       = 1,
		iCost        = 0,
		iCL = 13,
		sAura = "strong abjuration" ,
	},
	["Fortification (moderate)"] = {
		sStringName  = "moderate fortification",
		iBonus       = 3,
		iCost        = 0,
		iCL = 13,
		sAura = "strong abjuration" ,
	},
	["Ghost touch"] = {
		sStringName  = "ghost touch",
		iBonus       = 3,
		iCost        = 0,
		iCL = 15,
		sAura = "strong transmutation" ,
	},
	["Glamered"] = {
		sStringName  = "glamered",
		iBonus       = 2,
		iCost        = 2700,
		iCL = 10,
		sAura = "moderate illusion" ,
	},
	["Grinding"] = {
		sStringName  = "grinding",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Harmonizing"] = {
		sStringName  = "harmonizing",
		iBonus       = 4,
		iCost        = 15000,
		iCL = 7,
		sAura = "moderate illusion" ,
	},
	["Hosteling"] = {
		sStringName  = "hosteling",
		iBonus       = 3,
		iCost        = 7500,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Impervious"] = {
		sStringName  = "impervious",
		iBonus       = 1,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Invulnerability"] = {
		sStringName  = "invulnerability",
		iBonus       = 3,
		iCost        = 0,
		iCL = 18,
		sAura = "strong varies" ,
	},
	["Jousting"] = {
		sStringName  = "jousting",
		iBonus       = 2,
		iCost        = 3750,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Martyring"] = {
		sStringName  = "martyring",
		iBonus       = 4,
		iCost        = 18000,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Mirrored"] = {
		sStringName  = "mirrored",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate abjuration" ,
	},
	["Poison-resistant"] = {
		sStringName  = "poison resistant",
		iBonus       = 1,
		iCost        = 2250,
		iCL = 7,
		sAura = "moderate conjuration" ,
	},
	["Putrid"] = {
		sStringName  = "putrid",
		iBonus       = 3,
		iCost        = 10000,
		iCL = 5,
		sAura = "faint conjuration" ,
	},
	["Radiant"] = {
		sStringName  = "radiant",
		iBonus       = 3,
		iCost        = 7500,
		iCL = 6,
		sAura = "moderate evocation" ,
	},
	["Rallying"] = {
		sStringName  = "rallying",
		iBonus       = 2,
		iCost        = 5000,
		iCL = 5,
		sAura = "faint abjuration" ,
	},
	["Righteous"] = {
		sStringName  = "righteous",
		iBonus       = 5,
		iCost        = 27000,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Shadow"] = {
		sStringName  = "shadow",
		iBonus       = 2,
		iCost        = 3750,
		iCL = 5,
		sAura = "faint illusion" ,
	},
	["Shadow, greater"] = {
		sStringName  = "greater shadow",
		iBonus       = 5,
		iCost        = 33750,
		iCL = 15,
		sAura = "strong illusion" ,
	},
	["Shadow, improved"] = {
		sStringName  = "improved shadow",
		iBonus       = 4,
		iCost        = 15000,
		iCL = 10,
		sAura = "moderate illusion" ,
	},
	["Slick"] = {
		sStringName  = "slick",
		iBonus       = 2,
		iCost        = 3750,
		iCL = 4,
		sAura = "faint conjuration" ,
	},
	["Slick, greater"] = {
		sStringName  = "slick greater",
		iBonus       = 5,
		iCost        = 33750,
		iCL = 15,
		sAura = "strong conjuration" ,
	},
	["Slick, improved"] = {
		sStringName  = "slick improved",
		iBonus       = 4,
		iCost        = 15000,
		iCL = 10,
		sAura = "moderate conjuration" ,
	},
	["Spell resistance (13)"] = {
		sStringName  = "spell resistance (13)",
		iBonus       = 2,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Spell resistance (15)"] = {
		sStringName  = "spell resistance (15)",
		iBonus       = 3,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Spell resistance (17)"] = {
		sStringName  = "spell resistance (17)",
		iBonus       = 4,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Spell resistance (19)"] = {
		sStringName  = "spell resistance (19)",
		iBonus       = 5,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Spell storing"] = {
		sStringName  = "spell storing",
		iBonus       = 1,
		iCost        = 0,
		iCL = 12,
		sAura = "strong evocation" ,
	},
	["Stanching"] = {
		sStringName  = "stanching",
		iBonus       = 1,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Titanic"] = {
		sStringName  = "titanic",
		iBonus       = 3,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Unbound"] = {
		sStringName  = "unbound",
		iBonus       = 5,
		iCost        = 27000,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Undead controlling"] = {
		sStringName  = "undead controlling",
		iBonus       = 5,
		iCost        = 49000,
		iCL = 13,
		sAura = "strong necromancy" ,
	},
	["Unrighteous"] = {
		sStringName  = "unrighteous",
		iBonus       = 5,
		iCost        = 27000,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Vigilant"] = {
		sStringName  = "vigilant",
		iBonus       = 5,
		iCost        = 27000,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Warding"] = {
		sStringName  = "warding",
		iBonus       = 1,
		iCost        = 0,
		iCL = 12,
		sAura = "strong abjuration" ,
	},
	["Wild"] = {
		sStringName  = "wild",
		iBonus       = 3,
		iCost        = 0,
		iCL = 9,
		sAura = "moderate transmutation" ,
	},
}

aShieldAbilities = {
	["Animated"] = {
		sStringName  = "animated",
		iBonus       = 2,
		iCost        = 0,
		iCL = 12,
		sAura = "strong transmutation" ,
	},
	["Arrow catching"] = {
		sStringName  = "arrow catching",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate abjuration" ,
	},
	["Arrow deflection"] = {
		sStringName  = "arrow deflection",
		iBonus       = 2,
		iCost        = 0,
		iCL = 5,
		sAura = "faint abjuration" ,
	},
	["Bashing"] = {
		sStringName  = "bashing",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate transmutation" ,
	},
	["Blinding"] = {
		sStringName  = "blinding",
		iBonus       = 1,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Clangorous"] = {
		sStringName  = "clangorous",
		iBonus       = 1,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate evocation" ,
	},
	["Defiant"] = {
		sStringName  = "defiant",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate conjuration" ,
	},
	["Determination"] = {
		sStringName  = "determination",
		iBonus       = 5,
		iCost        = 30000,
		iCL = 10,
		sAura = "moderate conjuration" ,
	},
	["Energy resistance"] = {
		sStringName  = "energy resistance",
		iBonus       = 4,
		iCost        = 18000,
		iCL = 3,
		sAura = "faint abjuration" ,
	},
	["Energy resistance, greater"] = {
		sStringName  = "greater energy resistance",
		iBonus       = 5,
		iCost        = 66000,
		iCL = 11,
		sAura = "moderate abjuration" ,
	},
	["Energy resistance, improved"] = {
		sStringName  = "improved energy resistance",
		iBonus       = 5,
		iCost        = 42000,
		iCL = 7,
		sAura = "moderate abjuration" ,
	},
	["Fortification (heavy)"] = {
		sStringName  = "heavy fortification",
		iBonus       = 5,
		iCost        = 0,
		iCL = 13,
		sAura = "strong abjuration" ,
	},
	["Fortification (light)"] = {
		sStringName  = "light fortification",
		iBonus       = 1,
		iCost        = 0,
		iCL = 13,
		sAura = "strong abjuration" ,
	},
	["Fortification (moderate)"] = {
		sStringName  = "moderate fortification",
		iBonus       = 3,
		iCost        = 0,
		iCL = 13,
		sAura = "strong abjuration" ,
	},
	["Ghost touch"] = {
		sStringName  = "ghost touch",
		iBonus       = 3,
		iCost        = 0,
		iCL = 15,
		sAura = "strong transmutation" ,
	},
	["Grinding"] = {
		sStringName  = "grinding",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint transmutation" ,
	},
	["Hosteling"] = {
		sStringName  = "hosteling",
		iBonus       = 3,
		iCost        = 7500,
		iCL = 9,
		sAura = "moderate conjuration" ,
	},
	["Impervious"] = {
		sStringName  = "impervious",
		iBonus       = 1,
		iCost        = 0,
		iCL = 7,
		sAura = "moderate transmutation" ,
	},
	["Merging"] = {
		sStringName  = "merging",
		iBonus       = 2,
		iCost        = 0,
		iCL = 10,
		sAura = "moderate transmutation" ,
	},
	["Mirrored"] = {
		sStringName  = "mirrored",
		iBonus       = 1,
		iCost        = 0,
		iCL = 8,
		sAura = "moderate abjuration" ,
	},
	["Poison-resistant"] = {
		sStringName  = "poison resistant",
		iBonus       = 1,
		iCost        = 2250,
		iCL = 7,
		sAura = "moderate conjuration" ,
	},
	["Radiant"] = {
		sStringName  = "radiant",
		iBonus       = 3,
		iCost        = 7500,
		iCL = 6,
		sAura = "moderate evocation" ,
	},
	["Rallying"] = {
		sStringName  = "rallying",
		iBonus       = 2,
		iCost        = 5000,
		iCL = 5,
		sAura = "faint abjuration" ,
	},
	["Ramming"] = {
		sStringName  = "ramming",
		iBonus       = 1,
		iCost        = 0,
		iCL = 5,
		sAura = "faint evocation" ,
	},
	["Reflecting"] = {
		sStringName  = "reflecting",
		iBonus       = 5,
		iCost        = 0,
		iCL = 14,
		sAura = "strong abjuration" ,
	},
	["Spell resistance (13)"] = {
		sStringName  = "spell resistance 13 ",
		iBonus       = 2,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Spell resistance (15)"] = {
		sStringName  = "spell resistance (15)",
		iBonus       = 3,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Spell resistance (17)"] = {
		sStringName  = "spell resistance (17)",
		iBonus       = 4,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Spell resistance (19)"] = {
		sStringName  = "spell resistance (19)",
		iBonus       = 5,
		iCost        = 0,
		iCL = 15,
		sAura = "strong abjuration" ,
	},
	["Undead controlling"] = {
		sStringName  = "undead controlling",
		iBonus       = 5,
		iCost        = 49000,
		iCL = 13,
		sAura = "strong necromancy" ,
	},
	["Wild"] = {
		sStringName  = "wild",
		iBonus       = 3,
		iCost        = 0,
		iCL = 9,
		sAura = "moderate transmutation" ,
	},
	["Wyrmsbreath"] = {
		sStringName  = "wyrmsbreath",
		iBonus       = 2,
		iCost        = 5000,
		iCL = 5,
		sAura = "faint evocation" ,
	},
}

function GenerateMagicItem(databasenode, sEnhancementBonus, sSpecialMaterial, sSpecialAbility1, sSpecialAbility2)
	local bBonus, bMaterial, bAbility1, bAbility2 = checkComboboxes(sEnhancementBonus, sSpecialMaterial, sSpecialAbility1, sSpecialAbility2);
	local sType, sSubType = getItemType(databasenode);
	local sItemName, iItemCost, iItemWeight, sFullSubType, sItemProperties, iArmorPenalty, iArmorMaxDex, iArmorSpellFailure, iSpeed30, iSpeed20, iRange, sDamageType = getItemData(databasenode);
	
	local iEnchancementBonus = getEnhancementBonus(sEnhancementBonus);
	local iEffectiveBonus = iEnchancementBonus;
	local iCostBonus = iEnchancementBonus;
	local iExtraCost = 0;
	
	if iEnchancementBonus == 0 and (bAbility1 or bAbility2) then
		Comm.addChatMessage({text = Interface.getString("Error_1"), secret = true, icon ="ct_faction_foe"}); 
		return false;
	end
	
	local iAbilityBonus, iAbilityCostBonus, iAbilityExtraCost, sAbilityName1, sAbilityName2;
	local iCL1, iCL2 = 0, 0;
	local sAura1, sAura2 = "", "";
	if bAbility1 then
		iAbilityBonus, iAbilityCostBonus, iAbilityExtraCost, sAbilityName1, iCL1, sAura1 = getAbilityBonusAndCost(sSpecialAbility1, sType, sSubType)
		iEffectiveBonus = iEffectiveBonus + iAbilityBonus
		iCostBonus = iCostBonus + iAbilityCostBonus
		iExtraCost = iExtraCost + iAbilityExtraCost
		sDamageType, iRange = getSpecialAbilityData(sSpecialAbility1, sDamageType, iRange)
	end
	
	if bAbility2 then
		iAbilityBonus, iAbilityCostBonus, iAbilityExtraCost, sAbilityName2, iCL2, sAura2 = getAbilityBonusAndCost(sSpecialAbility2, sType, sSubType)
		iEffectiveBonus = iEffectiveBonus + iAbilityBonus
		iCostBonus = iCostBonus + iAbilityCostBonus
		iExtraCost = iExtraCost + iAbilityExtraCost
		sDamageType, iRange = getSpecialAbilityData(sSpecialAbility2, sDamageType, iRange)
	end
	
	if iEffectiveBonus > 10 then
		Comm.addChatMessage({text = Interface.getString("Error_2"), secret = true, icon ="ct_faction_foe"}); 
		return false;
	end
	
	local iMaterialCost, iNewWeight, iNewArmorPenalty, iNewArmorMaxDex, iNewArmorSpellFailure, iNewSpeed30, iNewSpeed20, bMasterworkMaterial, bFragileMaterial, sItemProperties, sDamageType = getMaterialData(sSpecialMaterial, iEnchancementBonus, sType, sSubType, sFullSubType, iItemWeight, iArmorPenalty, iArmorMaxDex, iArmorSpellFailure, iSpeed30, iSpeed20, iItemCost, sItemProperties, sDamageType);
	
	local iMasterworkCost = 0;
	if (not bMasterworkMaterial) or (not sEnhancementBonus == Interface.getString("none")) then
		iMasterworkCost = getMasterworkPrice(sType, sItemProperties);
	end
	if bMasterworkMaterial or sEnhancementBonus ~= Interface.getString("none") then
		sItemProperties = addProperty(sItemProperties, "masterwork");
		iNewArmorPenalty = iNewArmorPenalty + 1;
		if iNewArmorPenalty > 0 then
		   iNewArmorPenalty = 0;
		end
	end
	
	local iEnhancementCost = getEnchancementCost(iCostBonus, sType);
	local iTotalCost = iMaterialCost + iMasterworkCost + iEnhancementCost + iExtraCost;
	
	local sItemNewName = getItemNewName(sItemName, sEnhancementBonus, iEnchancementBonus, sSpecialMaterial, sAbilityName1, sAbilityName2, bAbility1, bAbility2, bMasterworkMaterial)
	
	local iNewBonus = 0;
	if iEnchancementBonus > 0 then
		iNewBonus = iEnchancementBonus;
	end
	local sNewNonIdentifiedName = "Unidentified " .. sItemName:lower();

	local iBonusCL = 3 * iNewBonus;
	local iCL = math.max(iBonusCL, iCL1, iCL2);
	
	local sAura = ""
	if bAbility1 then
		sAura = addProperty(sAura, sAura1);
	end
	if bAbility2 then
		sAura = addProperty(sAura, sAura2);
	end
	
	--Update fields in DB
	populateItemField(databasenode, 'aura', 'string', sAura);
	populateItemField(databasenode, 'bonus', 'number', iNewBonus);
	populateItemField(databasenode, 'cl', 'number', iCL);
	populateItemField(databasenode, 'cost', 'string', tostring(iTotalCost) .. " gp");
	populateItemField(databasenode, 'isidentified', 'number', 0);
	populateItemField(databasenode, 'locked', 'number', 1)
	populateItemField(databasenode, 'name', 'string', sItemNewName);
	populateItemField(databasenode, 'nonid_name', 'string', sNewNonIdentifiedName);
	populateItemField(databasenode, 'properties', 'string', sItemProperties);
	populateItemField(databasenode, 'weight', 'number', iNewWeight);
	
	if sType == "Weapon" or sType == "Ammunition" then
		populateItemField(databasenode, 'damagetype', 'string', sDamageType);
		populateItemField(databasenode, 'range', 'number', iRange);
	end
	
	if sType == "Armor" or sType == "Shield" then
		populateItemField(databasenode, 'checkpenalty', 'number', iNewArmorPenalty);
		populateItemField(databasenode, 'maxstatbonus', 'number', iNewArmorMaxDex);
		populateItemField(databasenode, 'speed20', 'number', iNewSpeed20);
		populateItemField(databasenode, 'speed30', 'number', iNewSpeed30);
		populateItemField(databasenode, 'spellfailure', 'number', iNewArmorSpellFailure);
	end
	Comm.addChatMessage({text = "Generated " .. sItemNewName, secret = true, icon="ct_faction_friend"}); 
	return true;
end

function populateItemField(databasenode, field, fieldType, fieldValue)
	local databaseChild = databasenode.getChild(field);
	if databaseChild then
		databaseChild.setValue(fieldValue);
	else
		databasenode.createChild(field, fieldType);
		databasenode.getChild(field).setValue(fieldValue);
	end
end

function getItemType(databasenode)
	local sItemType = "";
	local sItemSubType = "";
	local sType = databasenode.getChild("type").getValue();
	local sSubType = databasenode.getChild("subtype").getValue();
	
	if sType == "Weapon" then
		sItemType = "Weapon";
	elseif sType == "Armor" then
		if sSubType:match("Shield") then
			sItemType = "Shield";
		else
			sItemType = "Armor";
		end
	end
	
	if sSubType:match("Ammunition") then
		sItemType = "Ammunition";
	end

	if sType == "Weapon" then
		if sSubType:match("Melee") then
			sItemSubType = "Melee";
		elseif sSubType:match("Ranged") then
			sItemSubType = "Ranged";
		elseif sSubType:match("Firearm") then
			sItemSubType = "Firearm";
		else
			sItemSubType = "";
		end
	elseif sType == "Armor" then
		if sSubType:match("Light") then
			sItemSubType = "Light";
		elseif sSubType:match("Medium") then
			sItemSubType = "Medium";
		elseif sSubType:match("Heavy") then
			sItemSubType = "Heavy";
		end
	end
	return sItemType, sItemSubType;
end

function getEnhancementBonus(sEnhancementBonus)
	local iEnchancementBonus = 0;
	if sEnhancementBonus == Interface.getString("bonus_1") then
		iEnchancementBonus = 1;
	elseif sEnhancementBonus == Interface.getString("bonus_2") then
		iEnchancementBonus = 2;
	elseif sEnhancementBonus == Interface.getString("bonus_3") then
		iEnchancementBonus = 3;
	elseif sEnhancementBonus == Interface.getString("bonus_4") then
		iEnchancementBonus = 4;
	elseif sEnhancementBonus == Interface.getString("bonus_5") then
		iEnchancementBonus = 5;
	end
	return iEnchancementBonus;
end

function checkComboboxes(sBonus, sMaterial, sAbility1, sAbility2)
    local bBonus, bMaterial, bAbility1, bAbility2 = false, false, false, false
    local sNone = Interface.getString("none");
	
	if sBonus ~= sNone then
		bBonus = true;
	end
	
    if sMaterial ~= sNone then
        bMaterial = true;
    end

    if sAbility1 ~= sNone then
        bAbility1 = true;
    end

    if sAbility2 ~= sNone then
        bAbility2 = true;
    end

    if bAbility1 and sAbility1 == sAbility2 then
        bAbility2 = false;
		Comm.addChatMessage({text = Interface.getString("Warning_1"), secret = true, icon="ct_faction_neutral"}); 
    end
    return bBonus, bMaterial, bAbility1, bAbility2;
end

function getAbilityBonusAndCost(sSpecialAbility, sType, sSubType)
	local iBonus, iBonusCost, iExtraCost, sAbilityName, iCL, sAura = 0, 0, 0, "", 0, "";

	if sSubType == "Melee" then
		iBonus = aMeleeWeaponAbilities[sSpecialAbility].iBonus;
		iExtraCost = aMeleeWeaponAbilities[sSpecialAbility].iCost;
		sAbilityName = aMeleeWeaponAbilities[sSpecialAbility].sStringName;
		iCL = aMeleeWeaponAbilities[sSpecialAbility].iCL;
		sAura = aMeleeWeaponAbilities[sSpecialAbility].sAura;
	elseif sSubType == "Ranged" then
		iBonus = aRangedWeaponAbilities[sSpecialAbility].iBonus;
		iExtraCost = aRangedWeaponAbilities[sSpecialAbility].iCost;
		sAbilityName = aRangedWeaponAbilities[sSpecialAbility].sStringName;
		iCL = aRangedWeaponAbilities[sSpecialAbility].iCL;
		sAura = aRangedWeaponAbilities[sSpecialAbility].sAura;
	elseif sType == "Armor" then
		iBonus = aArmorAbilities[sSpecialAbility].iBonus;
		iExtraCost = aArmorAbilities[sSpecialAbility].iCost;
		sAbilityName = aArmorAbilities[sSpecialAbility].sStringName;
		iCL = aArmorAbilities[sSpecialAbility].iCL;
		sAura = aArmorAbilities[sSpecialAbility].sAura;
	elseif sType == "Shield" then
		iBonus = aShieldAbilities[sSpecialAbility].iBonus;
		iExtraCost = aShieldAbilities[sSpecialAbility].iCost;
		sAbilityName = aShieldAbilities[sSpecialAbility].sStringName;
		iCL = aShieldAbilities[sSpecialAbility].iCL;
		sAura = aShieldAbilities[sSpecialAbility].sAura;
	elseif sType == "Ammunition" then
		iBonus = aAmmunitionAbilities[sSpecialAbility].iBonus;
		iExtraCost = aAmmunitionAbilities[sSpecialAbility].iCost;
		sAbilityName = aAmmunitionAbilities[sSpecialAbility].sStringName;
		iCL = aAmmunitionAbilities[sSpecialAbility].iCL;
		sAura = aAmmunitionAbilities[sSpecialAbility].sAura;
	end
	
	if iExtraCost == 0 then
		iBonusCost = iBonus;
	end
	return iBonus, iBonusCost, iExtraCost, sAbilityName, iCL, sAura;
end

function getMaterialData(sMaterial, iEnhancingBonus, sType, sSubType, sFullSubType, iWeight, iArmorPenalty, iArmorMaxDex, iArmorSpellFailure, iSpeed30, iSpeed20, iItemBaseCost, sProperties, sDamageType)
	local iMaterialCost = iItemBaseCost;
	local iNewWeight = iWeight;
	local iNewArmorPenalty = iArmorPenalty;
	local iNewArmorMaxDex = iArmorMaxDex;
	local iNewArmorSpellFailure = iArmorSpellFailure;
	local iNewSpeed30 = iSpeed30;
	local iNewSpeed20 = iSpeed20;
	local bMasterworkMaterial, bFragileMaterial = false, false;
	local sNewProperties = sProperties;
	local sNewDamageType = sDamageType;
	
	if sMaterial ~= Interface.getString("none") then
		bMasterworkMaterial = aSpecialMaterials[sMaterial].bAlwaysMasterwork;
		bFragileMaterial = aSpecialMaterials[sMaterial].bFragile;
	end
	
	if sMaterial == Interface.getString("adamantine") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 5000;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 10000;
		elseif sSubType == "Heavy" then
			iMaterialCost = iMaterialCost + 15000;
		elseif sType == "Weapon" then
			iMaterialCost = iMaterialCost + 3000;
		elseif sType == "Ammunition" then
			iMaterialCost = iMaterialCost + 60;
		end
		sNewProperties = addProperty(sNewProperties, "adamantine")
		sNewDamageType = addProperty(sNewDamageType, "adamantine")
	elseif sMaterial == Interface.getString("alchemical_silver") then
		if sType == "Ammunition" then
			iMaterialCost = iMaterialCost + 2;
		else
			if sFullSubType:lower():match("light") then
				iMaterialCost = iMaterialCost + 20;
			elseif sFullSubType:lower():match("one-handed") then
				iMaterialCost = iMaterialCost + 90;
			elseif sFullSubType:lower():match("two-handed") then
				iMaterialCost = iMaterialCost + 180;
			elseif sProperties:lower():match("double") then
				iMaterialCost = iMaterialCost + 180;
			end
		end
		sNewDamageType = addProperty(sNewDamageType, "silver")
	elseif sMaterial == Interface.getString("angelskin") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 1000;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 2000;
		end
	elseif sMaterial == Interface.getString("blood_crystal") then
		if sType == "Weapon" then
			iMaterialCost = iMaterialCost + 1500;
		elseif sType == "Ammunition" then
			iMaterialCost = iMaterialCost + 30;
		end
	elseif sMaterial == Interface.getString("cold_iron") then
		iMaterialCost = 2 * iMaterialCost;
		if iEnhancingBonus > 0 then
			iMaterialCost = iMaterialCost + 2000;
		end
		sNewDamageType = addProperty(sNewDamageType, "cold iron")
	elseif sMaterial == Interface.getString("darkleaf_cloth") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 750;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 1500;
		else
			iMaterialCost = iMaterialCost + 375 * iWeight;
		end
		iNewArmorPenalty = iArmorPenalty + 3;
		iNewArmorMaxDex = iNewArmorMaxDex + 2;
		iNewArmorSpellFailure = iNewArmorSpellFailure - 10;
		if iNewArmorSpellFailure < 5 then
			iNewArmorSpellFailure = 5;
		end
	elseif sMaterial == Interface.getString("darkwood") then
		if sType == "Shield" then
			iNewArmorPenalty = iNewArmorPenalty + 2;
		end
		iMaterialCost = iWeight * 10 + getMasterworkPrice(sType, sProperties);
		iNewWeight = iNewWeight / 2;	
	elseif sMaterial == Interface.getString("dragonhide") then
		iMaterialCost = 2 * getMasterworkPrice(sType, sProperties);
	elseif sMaterial == Interface.getString("eel_hide") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 1200;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 1800;
		end
		iNewArmorPenalty = iArmorPenalty + 1;
		iNewArmorMaxDex = iNewArmorMaxDex + 1;
		iNewArmorSpellFailure = iNewArmorSpellFailure - 10;		
	elseif sMaterial == Interface.getString("elysian_bronze") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 1000;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 2000;
		elseif sSubType == "Heavy" then
			iMaterialCost = iMaterialCost + 3000;
		elseif sType == "Weapon" then
			iMaterialCost = iMaterialCost + 1000;
		elseif sType == "Ammunition" then
			iMaterialCost = iMaterialCost + 20;
		end
	elseif sMaterial == Interface.getString("fire_forged_steel") or sMaterial == Interface.getString("frost_forged_steel") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 1000;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 2500;
		elseif sSubType == "Heavy" then
			iMaterialCost = iMaterialCost + 3000;
		elseif sType == "Weapon" then
			iMaterialCost = iMaterialCost + 600;
		elseif sType == "Ammunition" then
			iMaterialCost = iMaterialCost + 15;
		end
	elseif sMaterial == Interface.getString("greenwood") then
		iMaterialCost = iWeight * 50 + getMasterworkPrice(sType, sProperties);
	elseif sMaterial == Interface.getString("griffon_mane") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 200;
		else
			iMaterialCost = iMaterialCost + iWeight * 50; 
		end
	elseif sMaterial == Interface.getString("living_steel") then
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 500;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 1000;
		elseif sSubType == "Heavy" then
			iMaterialCost = iMaterialCost + 1500;
		elseif sType == "Weapon" then
			iMaterialCost = iMaterialCost + 500;
		elseif sType == "Shield" then
			iMaterialCost = iMaterialCost + 100;
		elseif sType == "Ammunition" then
			iMaterialCost = 10;
		else
			iMaterialCost = iMaterialCost + 250 * iWeight;
		end
	elseif sMaterial == Interface.getString("mithral") then
		sNewDamageType = addProperty(sNewDamageType, "silver")
		iNewWeight = iNewWeight / 2;
		if sSubType == "Light" then
			iMaterialCost = iMaterialCost + 1000;
		elseif sSubType == "Medium" then
			iMaterialCost = iMaterialCost + 4000;
			iNewSpeed30 = 30;
			iNewSpeed20  = 20;
		elseif sSubType == "Heavy" then
			iMaterialCost = iMaterialCost + 9000;
			iNewSpeed30 = 20;
			iNewSpeed20  = 15;
		elseif sType == "Shield" then
			iMaterialCost = iMaterialCost + 1000;
		else
			iMaterialCost = iMaterialCost + 500 * iWeight;
		end
		iNewArmorPenalty = iArmorPenalty + 3;
		iNewArmorMaxDex = iNewArmorMaxDex + 2;
		iNewArmorSpellFailure = iNewArmorSpellFailure - 10;
		if iNewArmorSpellFailure < 0 then
			iNewArmorSpellFailure = 0;
		end
	elseif sMaterial == Interface.getString("viridium") then
		if sType == "Weapon" then
			iMaterialCost = iMaterialCost + 200;
		elseif sType == "Ammunition" then
			iMaterialCost = iMaterialCost + 20;
		end
	elseif sMaterial == Interface.getString("whipwood") then
		iMaterialCost = iMaterialCost + 500;
	elseif sMaterial == Interface.getString("wyroot") then
		iMaterialCost = iMaterialCost + 1000;
	elseif sMaterial == Interface.getString("bone") then
		iMaterialCost = iItemBaseCost / 2;
	--elseif sMaterial == Interface.getString("bronze") then
	elseif sMaterial == Interface.getString("gold") then
		iNewArmorPenalty = iNewArmorPenalty - 2;
		iNewWeight = iNewWeight * 1.5;
		iMaterialCost = 10 * iMaterialCost;
	elseif sMaterial == Interface.getString("obsidian") then
		iNewWeight = iNewWeight * 0.75;
		iMaterialCost = iNewWeight / 2;
	elseif sMaterial == Interface.getString("stone") then
		iNewWeight = iNewWeight * 0.75;
		iMaterialCost = iNewWeight / 4;
	end
	
	if bMasterworkMaterial and sType == "Armor" and iNewArmorPenalty == iArmorPenalty then
		iNewArmorPenalty = iArmorPenalty + 1;
	end
	if iNewArmorPenalty > 0 then
		iNewArmorPenalty = 0;
	end
	
	return iMaterialCost, iNewWeight, iNewArmorPenalty, iNewArmorMaxDex, iNewArmorSpellFailure, iNewSpeed30, iNewSpeed20, bMasterworkMaterial, bFragileMaterial, sNewProperties, sNewDamageType;
end

function getMasterworkPrice(sType, sProperties)
	iMasterworkPrice = 0;
	bDoubleProperty = sProperties:lower():match("double");
	
	if sType == "Armor" or sType == "Shield" then
		iMasterworkPrice = 150;
	elseif sType == "Ammunition" then
		iMasterworkPrice = 6;
	elseif sType == "Weapon" then
		if bDoubleProperty then
			iMasterworkPrice = 600;
		else
			iMasterworkPrice = 300;
		end
	end
	return iMasterworkPrice;
end

function getItemData(databasenode)
	local dItemName = databasenode.getChild("name");
	local dItemProperties = databasenode.getChild("properties");
	local dItemWeight = databasenode.getChild("weight");
	local dItemCost = databasenode.getChild("cost");
	local dSubtype = databasenode.getChild("subtype");
	local dArmorPenalty = databasenode.getChild("checkpenalty");
	local dArmorMaxDex = databasenode.getChild("maxstatbonus");
	local dArmorSpellFailure = databasenode.getChild("spellfailure");
	local dSpeed30 = databasenode.getChild("speed30");
	local dSpeed20 = databasenode.getChild("speed20");
	local dDamageType = databasenode.getChild("damagetype");
	local dRange = databasenode.getChild("range");
	
	local sItemName, iItemCost, iItemWeight, sFullSubType, sItemProperties, iArmorPenalty, iArmorMaxDex, iArmorSpellFailure, iSpeed30, iSpeed20, sItemCost, sDamageType, iRange = "", 0, 0, "", "", 0, 0, 0, 0, 0, "", "", 0;
	
	if dItemName then sItemName = dItemName.getValue() end
	if dItemProperties then sItemProperties = dItemProperties.getValue()  end
	if dItemWeight then iItemWeight = dItemWeight.getValue() end
	if dItemCost then sItemCost = dItemCost.getValue() end
	if dSubtype then sFullSubType = dSubtype.getValue() end
	if dArmorPenalty then iArmorPenalty = dArmorPenalty.getValue() end
	if dArmorMaxDex then iArmorMaxDex = dArmorMaxDex.getValue() end
	if dArmorSpellFailure then iArmorSpellFailure = dArmorSpellFailure.getValue() end
	if dSpeed30 then iSpeed30 = dSpeed30.getValue() end
	if dSpeed20 then iSpeed20 = dSpeed20.getValue() end
	if dDamageType then sDamageType = dDamageType.getValue() end
	if dRange then iRange = dRange.getValue() end
		
	local sCoinValue, sCoin = sItemCost:match("^%s*([%d,]+)%s*([^%d]*)$");
	if not sCoinValue then
		sCoin, sCoinValue = sItemCost:match("^%s*([^%d]+)%s*([%d,]+)%s*$");
	end
	if sCoinValue then
		sCoinValue = string.gsub(sCoinValue, ",", "");
		iItemCost = tonumber(sCoinValue) or 0;	
		sCoin = StringManager.trim(sCoin);
		if sCoin == "pp" then
			iItemCost = 10 * iItemCost;
		elseif sCoin == "sp" then
			iItemCost = iItemCost / 10;
		elseif sCoin == "cp" then
		iItemCost = iItemCost / 100;
		end
	end
	
	return sItemName, iItemCost, iItemWeight, sFullSubType, sItemProperties, iArmorPenalty, iArmorMaxDex, iArmorSpellFailure, iSpeed30, iSpeed20, iRange, sDamageType;
end

function getEnchancementCost(iEnchancementBonus, sType)
	local aBonusPriceArmor = {0, 1000, 4000, 9000, 16000, 25000, 36000, 49000, 64000, 81000, 100000}
	local aBonusPriceWeapon = {0, 2000, 8000, 18000, 32000, 50000, 72000, 98000, 128000, 162000, 200000}
	local aBonusPriceAmmunition = {0, 40, 160, 360, 640, 1000, 1440, 1960, 2560, 3240, 4000}
	local iEnchantmentCost = 0;
	
	if sType == "Weapon" then
		iEnchantmentCost = aBonusPriceWeapon[iEnchancementBonus + 1];
	elseif sType == "Armor" or sType == "Shield" then
		iEnchantmentCost = aBonusPriceArmor[iEnchancementBonus + 1];
	elseif sType == "Ammunition" then
		iEnchantmentCost = aBonusPriceAmmunition[iEnchancementBonus + 1];
	end
	return iEnchantmentCost;
end

function getItemNewName(sItemName, sEnhancementBonus, iEnchancementBonus, sSpecialMaterial, sAbilityName1, sAbilityName2, bAbility1, bAbility2, bMasterworkMaterial)
	local sItemNewName = "";
	if sEnhancementBonus == Interface.getString("bonus_mwk") and (not bMasterworkMaterial) then
		sItemNewName = sItemNewName .. "masterwork" .. " ";
	end
	if iEnchancementBonus > 0 then
		sItemNewName = sItemNewName .. "+" .. tostring(iEnchancementBonus) .. " ";
	end
	if sSpecialMaterial ~= Interface.getString("none") then
		sItemNewName = sItemNewName .. aSpecialMaterials[sSpecialMaterial].sStringName .. " ";
	end
	if bAbility1 then
		sItemNewName = sItemNewName .. sAbilityName1 .. " ";
	end
	if bAbility2 then
		sItemNewName = sItemNewName .. sAbilityName2 .. " ";
	end
	sItemNewName = sItemNewName .. sItemName;
	sItemNewName = sItemNewName:lower();
	sItemNewName = sItemNewName:gsub("^%l", string.upper);
	return sItemNewName;
end

function addProperty(sItemProperties, sProperty)
	local sNewItemProperties = "";
	if sItemProperties == "" then
		sNewItemProperties = sProperty;
	else
		sNewItemProperties = sItemProperties .. ", " .. sProperty;
	end
	return sNewItemProperties;
end

function getSpecialAbilityData(sSpecialAbility, sDamagetype, iRange)
	local sNewDamageType = sDamagetype:lower();
	local iNewRange = iRange;
	if sSpecialAbility == Interface.getString("anarchic") then
		sNewDamageType = addProperty(sNewDamageType, "chaotic");
	elseif sSpecialAbility == Interface.getString("axiomatic") then
		sNewDamageType = addProperty(sNewDamageType, "lawful");
	elseif sSpecialAbility == Interface.getString("deadly") then
		sNewDamageType = string.gsub(sNewDamageType, ", nonlethal", "");
		sNewDamageType = string.gsub(sNewDamageType, "nonlethal", "");
	elseif sSpecialAbility == Interface.getString("distance") then
		iNewRange = 2 * iNewRange;
	elseif sSpecialAbility == Interface.getString("holy") then
		sNewDamageType = addProperty(sNewDamageType, "good");
	elseif sSpecialAbility == Interface.getString("merciful") then
		sNewDamageType = addProperty(sNewDamageType, "nonlethal");
	elseif sSpecialAbility == Interface.getString("throwing") then
		iNewRange = 10;
	elseif sSpecialAbility == Interface.getString("unholy") then
		sNewDamageType = addProperty(sNewDamageType, "evil");
	end
	return sNewDamageType, iNewRange;
end




